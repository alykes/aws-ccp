## Section 5 - EC2  

### Budget Setup  

You need to allow access to IAM users for them to be able to see Billing.  
Log in as root  
Click on the user and select Account  
Find the heading `IAM user and role access to Billing information` and click `Edit`  
Select the `Activate IAM Access` tickbox and `Update`  
This allows any user who is an `Administrator` to have access to billing data


### Billing Page 

```
To see which services are costing money:  
Go into Billing  
Look for `Charges by service` to see which services are costing money  
```

- Free Tier page  
Under `Billing`, you can select `Free tier` to view how much you are using of the free tier services  

- Budgets page  
This is where you set up alerts based on spend for the account  
- Create a Budget  
  - Some templates you can use are:  
    - Zero Spend Budget (you can be notified via email if any spend is incurred, that is anything `> $0.01` ; good to tracking free tier)  
    - Monthly Spend Budget (you set a limit and are notified when **actual spend** hits `85%`, `100%` and if **forecasted spend** is going to hit `100%`)  


**EC2 - Elastic Compute Cloud**  

### Basics  
Elastic Compute Cloud  
It consists of a few common services:  
- `EC2` - pay-as-you-go server  
- `EBS` - storing data on virtual drives  
- `ELB` - distributing load across machines  
- `ASG` - scaling services using an Auto-Scaling Group  

Its fundamental to understand how the cloud works.  

### EC2 Sizing and configuration options  
- OS: Windows, Linux, MacOS  
- Compute: Power & Cores  
- RAM: amount  
- Storage:  
  - Network Attached - EBS & EFS  
  - Hardware Attached - EC2 Instance Store   
- Network: Speed of the card, Public IP  
- Firewall: Security Group Rules  
- Bootstrap script: EC2 User Data  

### EC2 User Data  
It's possible to bootstrap an instance using EC2 User Data Scripts  
`Bootstrapping` simply means launching commands when a machine starts  
The bootstrap script is only **run once**, when the instance first starts  
EC2 user data is used to automate boot tasks such as:   
- Installing updates  
- Installing software  
- Downloading common files from the internet  
- Anything else that you want it to do  
- The EC2 User Data Script runs with **root user** permissions!  

### Launching an Instance  
`EC2` -> `Instances` -> `Launch Instance`  
Free tier instance is `t2.micro`  
- Click on `Compare instance types` to review other instances that are available.  

- Create an SSH key:  
  - Choose RSA for most keys (ED25519 is not supported in Windows Instances)  
  - Choose `.pem` for Mac, Linux, for windows 10+ else select `.ppk` for PuTTY  

- Create a Security Group  
  - Best practise to isolate this as much as possible  

- Cconfigure storage  
  - Remember that `Delete on Termination` is set by default.  

- Under Advanced, confirgure `User data`  
  - Example:  
  ```
  #!/bin/bash
  # For use in User Data
  # Install httpd (Linux Version 2)
  yum update -y
  yum install -y httpd
  systemctl start httpd
  systemctl enable httpd
  echo "<h1>Hello World from $(hostname -f)</h1>" > /var/www/html/index.html
  ```  

  - Check the summary  
  Click `Launch instance`  

  ### Stopping an instance  
  AWS will not charge you for compute, only storage.  

  Note: When you stop and then start an instance, the public IP will `likely` change. **The private IP remains the same.**  

  Note: You can terminate a `running` instance.  

### EC2 Instance Types  
https://aws.amazon.com/ec2/instance-types  
- General Purpose  
- Compute Optimised  
- Memory Optimised  
- Accelerated Computing  
- Storage Optimised  
- HPC Optimised
- Instance Features  
- Measuring Instance Performance  

**Naming Convention**
m5.2xlarge  
- `m` is the instance class  
- `5` is the generation  
- `2xlarge` is the size within the instance class  

**Need to know for the exam**  
- `General Purpose`  
  Start with T, M as well as Mac; t3, t2, M7a, M6i, M5   
  Great for a diversity of workloads  
  Balance between **compute**, **memory** and **networking**  

- `Compute Optimised`  
  Start with C; C7g, C6g, C5  
  Good for compute intensive tasks that require high performance  
  Batch processing workloads  
  Media transcoding  
  High performance web servers  
  High Performance Computing (HPC)  
  Scientific Modeling and Machine Learning  
  Dedicated gaming servers  

- `Memory Optimised`  
  Start with R, X or z; R6g, R5, R5a, R5b, R5n, R4, X1e, X1 High Memory, z1d
  Fast performance workloads that process large data sets **in memory**  
  High performance, relational/non-relational databases  
  Distributed web scale cache stores
  In-memory databased optimised for BI  
  Applications performing real-time processing of big unstructured data  

- `Storage Optimised`  
  Start with I, D or H; I4g, I4i, D2, D3, H1
  Good when accessing large data sets on the local storage  
  High frequency online transaction processing (OLTP) systems  
  Relation and NoSQL DBs
  Cache in-memory DBs like redis  
  Data warehousing applications  
  Distributed File Systems  

- A good comparison website is https://ec2instances.info which redirects to https://instances.vantage.sh/  


### Security Groups  
In EC2 -> Network & Security  
Fundamental bit of network security for AWS  
  - They control flow of traffic, ingress and egress for EC2 instances  
  - Security Groups only contain **ALLOW** rules  
  - Security groups can reference **IP or other security groups**  

**Deeper Dive**  
- A security group acts as a `firewall` for an EC2 instance  
- They regulate:
  - Access to ports  
  - Authorised IP ranges - IPv4 or IPv6  
  - Control inbound and outbound  
  - Consists of Type, protocol, port range, soource and description.  
  - You don't need to know how to configure a security group for the exam.  

**Good to know about Security Groups**  
- can be attached to multiple instances  
- located down to region/VPC combination  
- they live ouside the EC2 instance, they aren't part of the instance itself  
- Maintain one seperate security group for ssh access  
- If you get a timeout, then it's probably a security group issue  
- If you get a connection refused error, then it's an application issue not a security group problem  
- By **default** all inbound traffic is **Blocked** and outbound traffic is **Allowed**  

**Reference Security Groups from Other Security Groups**  
Good for load balancers  

**Classic ports you need to know for the exams**  
22 SSH - Secure Shell  
21 FTP - File Trasfer Protocol  
22 SFTP - Secure File Trasfer Protocol  
80 HHTP - unsecured wed traffic  
443 HTTPS - secured wed traffic  
3389 RDP - Remote Desktop Protocol  

### SSH - Secure Shell  
|OS|Software|  
|---|---|  
|Mac|SSH|  
|Linux|SSH|  
|Windows < 10|PuTTY|  
|Windows >= 10|PuTTY or SSH|


